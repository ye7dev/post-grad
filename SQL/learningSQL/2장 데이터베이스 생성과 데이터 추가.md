# 2장 데이터베이스 생성과 데이터 추가

- 한국어 등 각 문자마다 여러 바이트의 저장 공간 필요한 경우 (multibyte character set)
    
    ```sql
    varchar(20) character set euckr # 칼럼 정의 시 기본이 아닌 캐릭터셋 선택하기 
    ```
    
- 텍스트 자료형 선택 시 고려사항
    - 텍스트 칼럼에 로드되는 데이터가 해당 유형의 최대 크기를 초과하면 데이터가 잘림
    - 데이터를 열에 로드하면 후행 공백이 제거되지 않음
    - 정렬, 그룹화에 text (자료형) 칼럼을 사용할 경우, 처음에는 1024 바이트만 사용됨
- 숫자가 쓰이는 다양한 방식
    - 고객 주문의 배송 여부 → boolean
    - 트랜잭션 테이블의 시스템 생성 기본 키 → 1에서 시작해서 매우 큰 수까지 1씩 증가
    - 고객의 온라인 장바구니 품목 번호 → 1~200 사이 양의 정수
    - 회로 기판 드릴 기계의 위치 데이터 → 소수점 8자리까지 정확도 요구
        - 부동소수점 숫자의 경우 - float(p,s), double(p,s)
            - p: preceision. 소수점 왼쪽, 오른쪽 합쳐서 허용되는 자릿수
            - s: scale. 소수점 오른쪽의 허용 자릿수
- DB에서 사용되는 시간 데이터의 예
    - 고객의 주문 발송 등 특정 이벤트 발생이 예상되는 미래의 날짜 → 자료형 date
    - 고객의 주문 물품이 배송된 날짜 → 자료형 datetime. 배송된 시간까지 추적하는 게 중요
    - 사용자가 테이블에서 특정 행을 수정한 날짜 및 시간 → 자료형 timestamp. 테이블에 행이 추가되거나 수정될 때 mySQL 서버에 의해 현재 날짜/시간으로 timestamp 열이 자동으로 채워짐
    - 직원의 생년월일 → 자료형 date
    - 데이터 웨어하우스의 연도별 세일즈 팩트 테이블 행의 연도
    - 자동차 조립 라인에서 배선 장치를 완성하는데 걸리는 시간 → 자료형 time. 날짜는 관심 없고 필요한 시간/분/초에만 관심.
- 정제
    - 어떤 칼럼이 여러 정보로 구성된 복합 객체인지 → 주소 같은 경우 거리, 도시, 국가 등으로 구성되어 있는데 이를 각기 다른 칼럼으로 분류하는 것이 좋음 (정규화)
    - 여러 사람이 동일한 정보를 가질 수 있으므로 table의 고유성을 보장하는 칼럼이 있는지 확인 → 없으면 고유성을 보장하는 Primary key 생성
    - favorite_foods 칼럼은 0개 또는 1개 이상의 독립적인 항목을 포함하는 enumeration(목록) → 특정 음식이 어떤 사람에게 귀속될 수 있는지 알 수 있도록, 이 데이터에 대한 별도의 테이브를 작성하고, person 테이블에 대한 외래 키가 포함되도록 하는게 가장 좋음
        - person table에는 더 이상 최애 음식에 대한 칼럼이 없음
        - 대신 favorite_food table이 생기고, person_id와 food 칼럼에 테이블의 기본키 구성
            - person_id의 경우 person table에 대한 외래 키이기도 함
- MySQL 설치 관련 참고 링크
    - [brew로 처음 설치](https://clolee.tistory.com/49), [삭제](https://velog.io/@hyebinnn/MySQL-에러-ERROR-2002-HY000-Cant-connect-to-local-MySQL-server-through-socket-tmpmysql.sock), [공식 설치 파일로 다시 설치](https://velog.io/@lemythe423/Mac-OS-MySQL-MySQL-Workbench-설치하기-2024)
    - 소노마는 맥 14. 나는 M1이라 ARM
- 외래키 설정시 주의
    - 자료형 뿐만 아니라 signed, unsigned까지 모두 일치해야 함
- insert문 관련 주의
    - birth_date 칼럼에 문자열을 제공해도, 필수 형식에 맞춰서 제공하면 알아서 날짜로 변환
- XML 데이터 관련
    - mysql -u root -p --xml 로 로그인 한 다음, SELECT * FROM learning_sql.favorite_food; 하면 XML로 출력됨
- 콤마 주의
    - WHERE 절 앞에는 콤마가 오면 안됨
    - 틀린 예
        
        ```sql
        UPDATE person
        SET street = '1225 Trement St.',
        	city = 'Boston',
        	state = 'MA', 
            country = 'USA',
            postal_code = '02138',
        WHERE person_id = 1;
        ```
        
- 실수 하기 쉬운 에러
    - 고유하지 않은 기본키
        - 기본키 값 중복으로 입력하는 경우 에러 발생
            
            ```sql
            INSERT INTO person
            	(person_id, fname, lname, eye_color, birth_date)
                VALUES (1, 'Charles', 'Fulton', 'GR', '1968-01-15');
            # Error Code: 1062. Duplicate entry '1' for key 'person.PRIMARY'
            ```
            
    - 존재하지 않는 외래 키
        - person table의 person_id를 favorite_food table에서 참조 중
            
            → person table이 parent, favorite_food가 child. 
            
            - parent에 먼저 기록되지 않은 데이터가 child에 기록될 수 없음
            
            ```sql
            INSERT INTO favorite_food (person_id, food)
            VALUES (999, 'lasagna');
            # Error Code: 1452. Cannot add or update a child row: a foreign key constraint fails (`learning_sql`.`favorite_food`, CONSTRAINT `fk_fav_food_person_id` FOREIGN KEY (`person_id`) REFERENCES `person` (`person_id`))
            ```
            
    - 열 값 위반
        - 카테고리 안에 있는 값만 가질 수 있도록 CHECK 제약 걸었는데 위반하는 경우
            
            ```sql
            UPDATE person 
            SET eye_color = 'ZZ'
            WHERE person_id = 1;
            # Error Code: 3819. Check constraint 'eyes' is violated.
            ```
            
    - 잘못된 날짜 변환
        - 문자열이 예상 형식에 맞지 않는 경우
            
            ```sql
            UPDATE person
            SET birth_date = 'DEC-21-1980'
            WHERE person_id = 1;
            # Error Code: 1292. Incorrect date value: 'DEC-21-1980' for column 'birth_date' at row 1
            ```
            
- 날짜 형식 문자열을 명시적으로 지정
    - 기존 데이터 문자열을 지정 형식으로 받아오기
    
    ```sql
    UPDATE person
    SET birth_date = str_to_date('DEC-21-1980', '%b-%d-%Y')
    WHERE person_id = 1;
    ```
    
    - 날짜 형식의 구성 요소
        
        
        | 요소 | 정의 |
        | --- | --- |
        | %a | 요일 이름 축약해서 표시 (Sun, Mon, etc.) |
        | %b | 달 이름 축약해서 표시 (Jan, Feb, etc.) |
        | %c | 숫자로 달 표시 (1~12) |
        | %d | 숫자로 날짜 표시 (01~31) |
        | %H | 24시간 포맷으로 시간 (00~23) |
        | %h | 12시간 포맷으로 시간 (01~12) |
        | %i | 00~59 분으로 표현 |
        | %j | 일년 365일 중 몇 번째 날인지 (001~366) |
        | %M | 달 이름을 모두 표기 (January, February, etc.) |
        | %m | 숫자로 몇 번째 달인지 표기 (01~12) |
        | %p | AM 또는 PM |
        | %s | 00~59 초로 표현 |
        | %W | 요일 이름 모두 표기 (Sunday, Monday, etc.) |
        | %w | 0~6 요일을 숫자로 표기 (0 for Sunday, etc.) |
        | %Y | 4자리 연도 |
        | %y | 2자리 연도 |
        | %f | 마이크로초 (000000~999999) |
- 4/17 실행 로그 중 기억할만 한 것
    
    ```sql
    ALTER TABLE favorite_food 
    	ADD CONSTRAINT fk_fav_food_person_id 
    		FOREIGN KEY (person_id) 
    		REFERENCES person (person_id)
    ```