# 10ì¥ ì¡°ì¸ ì‹¬í™”

### ì™¸ë¶€ ì¡°ì¸

- ë‚´ë¶€ ì¡°ì¸: ì¿¼ë¦¬ê°€ ì¡°ì¸ ì¡°ê±´ì„ ì¶©ì¡±í•˜ëŠ” í–‰ë§Œ ë°˜í™˜
- ì™¸ë¶€ ì¡°ì¸: join í•˜ë ¤ëŠ” í…Œì´ë¸”ì— í–‰ì´ ìˆëŠ”ì§€ ì—¬ë¶€ì— ìƒê´€ ì—†ì´ ì§€ê¸ˆ í…Œì´ë¸”ì— ê´€í•œ í–‰ì„ ëª¨ë‘ ë°˜í™˜
    - left, right í‚¤ì›Œë“œëŠ” ë°ì´í„°ì— nullì´ ìˆì„ ìˆ˜ ìˆëŠ” tableì„ ì„œë²„ì— ì•Œë ¤ì£¼ëŠ” ì—­í• 
        - a left join b == b right join a (aì˜ ëª¨ë“  í–‰, bì˜ ì¶”ê°€ì ì¸ ì—´)
    - ë³´í†µì€ left outer joinì„ ë§ì´ ì‚¬ìš©í•œë‹¤
    - `left outer join` joinì˜ ì™¼ìª½ì— ìˆëŠ” í…Œì´ë¸”ì˜ ëª¨ë“  í–‰ì„ í¬í•¨. ì˜¤ë¥¸ìª½ í…Œì´ë¸”ì— ë§¤ì¹­ë˜ëŠ” í–‰ì´ ì—†ìœ¼ë©´(ì¡°ì¸ ì¡°ê±´ì´ ì‹¤íŒ¨í•˜ë©´) nullë¡œ í‘œì‹œ
        - ê²°ê³¼ì…‹ì˜ í–‰ìˆ˜ëŠ” ì™¼ìª½ í…Œì´ë¸”ì´ ê²°ì • â†” ì¼ì¹˜í•˜ëŠ” í•­ëª©ì´ ë°œê²¬ë  ë•Œë§ˆë‹¤ ì—´ ê°’ì„ ì œê³µí•˜ëŠ” ê±´ ì˜¤ë¥¸ìª½ í…Œì´ë¸”
        
        ```sql
        select f.film_id, f.title, count(i.inventory_id) num_copies
        from film f
        	left outer join inventory i
            on f.film_id = i.film_id
        group by f.film_id, f.title;
        ```
        
    - `right outer join` joinì˜ ì˜¤ë¥¸ìª½ í…Œì´ë¸”ì˜ ëª¨ë“  í–‰ì„ í¬í•¨. ì¡°ì¸ ì¡°ê±´ì´ ë§ìœ¼ë©´ ì—´ ê°’ì„ ì œê³µí•˜ëŠ” í…Œì´ë¸”ì€ ì™¼ìª½ í…Œì´ë¸”
        
        ```sql
        select f.film_id, f.title, i.inventory_id
        from film f
        	right outer join inventory i
            on f.film_id = i.film_id
        where f.film_id between 13 and 15;
        ```
        
    - 3ë°©í–¥ ì™¸ë¶€ ì¡°ì¸ (three-way outer join)
        - LEFT OUTER JOINì„ ì—¬ëŸ¬ ê°œ ìˆ˜í–‰í•˜ë”ë¼ë„, ëª¨ë“  í–‰ì˜ ë°ì´í„°ë¥¼ í•­ìƒ í¬í•¨í•˜ëŠ” í…Œì´ë¸”ì€ ì›ë˜ FROM ì ˆì—ì„œ ì–¸ê¸‰ëœ ì²« ë²ˆì§¸ í…Œì´ë¸”(ì™¼ìª½ í…Œì´ë¸”)ì…ë‹ˆë‹¤. ë‹¤ë¥¸ í…Œì´ë¸”ë“¤ì€ ì¡°ì¸ ì¡°ê±´ì— ë”°ë¼ ë§¤ì¹­ë˜ëŠ” í–‰ì´ ìˆìœ¼ë©´ í¬í•¨ë˜ê³ , ë§¤ì¹­ë˜ì§€ ì•ŠëŠ” ê²½ìš°ì—ëŠ” NULL ê°’ì´ ë©ë‹ˆë‹¤.
        
        ```sql
        select f.film_id, f.title, i.inventory_id, r.rental_date
        from film f
        	left outer join inventory i
            on f.film_id = i.film_id
            left outer join rental r
            on i.inventory_id = r.inventory_id
        where f.film_id between 13 and 15;
        ```
        

### êµì°¨ ì¡°ì¸

- ë°ì¹´ë¥´íŠ¸ ê³± - ëª¨ë“  ê°€ëŠ¥í•œ í–‰ ì¡°í•©
    - on ì¡°ê±´ ì¤„ í•„ìš” ì—†ìŒ. ë‘ í…Œì´ë¸”ì˜ í–‰ ìˆ˜ë¥¼ ê³±í•œ ê°’ì´ ê²°ê³¼ ì…‹ì˜ í–‰ìˆ˜
    
    ```sql
    select c.name category_name, l.name language_name
    from category c
    	cross join language l;
    ```
    
- êµì°¨ ì¡°ì¸ì´ ìœ ìš©í•œ ìƒí™©
    - [ì„œë¸Œì¿¼ë¦¬ ì„¸ ê°œì™€ union allì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•](https://www.notion.so/Learning-SQL-6f5006f0a7ae4f3e8456a06a399a1456?pvs=21)
        - ë‹¤ë¥¸ í…Œì´ë¸”ì— ì¡°ì¸í•  ìˆ˜ ìˆëŠ” 3ê°œì˜ í–‰ì„ ê°€ì§„ í…Œì´ë¸”ì„ ë§Œë“œëŠ” ê²½ìš°
            - ì˜ˆ-ì´ ì˜í™” ëŒ€ì—¬ë£Œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê³ ê°ì„ ì„¸ ê·¸ë£¹ìœ¼ë¡œ ë¶„ë¥˜í•  ë•Œ í•„ìš”í•œ í…Œì´ë¸”
        - union allì„ ì‚¬ìš©í•´ì„œ ë‹¨ì¼ í–‰ í…Œì´ë¸”ì„ ë³‘í•©í•˜ë ¤ëŠ” ë°©ë²•ì€ í° í…Œì´ë¸”ì„ ë§Œë“¤ì–´ì•¼ í•˜ëŠ” ê²½ìš°ì—ëŠ” ì˜ ë§ì§€ ì•ŠìŒ
            - ì˜ˆ-ë‚ ì§œë§ˆë‹¤ í•œ í–‰ ì”© 366ê°œ(2020ë…„ì€ ìœ¤ë‹¬)ë¥¼ ë§Œë“¤ë ¤ë©´ ë„ˆë¬´ í”¼ê³¤
                
                ```sql
                select '2020-01-01' dt 
                union all
                ...
                select '2020-12-31' dt
                ```
                
    - ë” ë‚˜ì€ ë°©ë²•
        - í•˜ë‚˜ì˜ ì—´ì— 0~366 ì‚¬ì´ì˜ ìˆ«ìë¥¼ í¬í•¨í•˜ëŠ” 366ê°œ í–‰ì´ ìˆëŠ” í…Œì´ë¸”ì„ ìƒì„± â†’ 2020-01-01ë¶€í„° ì¼ìˆ˜ë¥¼ ë”í•´ì£¼ê¸°
        - 366ê°œ í–‰ì´ ìˆëŠ” í…Œì´ë¸” ìƒì„±í•˜ê¸°
            1. ì¼ì˜ ìë¦¬, ì‹­ì˜ ìë¦¬, ë°±ì˜ ìë¦¬ ìˆ˜ë¥¼ ë°ì¹´ë¥´íŠ¸ ê³±í•˜ê¸°! 
                - ì‹­ì˜ ìë¦¬, ë°±ì˜ ìë¦¬ì—ë„ 0ì„ ë„£ì–´ì¤˜ì„œ í•œ ìë¦¬, ë‘ ìë¦¬ ìˆ˜ê°€ ë§Œë“¤ì–´ì§€ê²Œë” í•´ì•¼ í•¨
                - ì´ëŸ¬ë©´ ì‚¬ì‹¤ 400ê°œ(0~399)ê°€ ë§Œë“¤ì–´ì§€ì§€ë§Œ ì´ˆê³¼ í–‰ì€ ì‰½ê²Œ ì œê±° ê°€ëŠ¥
                - ì½”ë“œ
                    
                    ```sql
                    select ones.num + tens.num + hundreds.num days
                    from (select 0 num union all
                    	select 1 num union all
                    	select 2 num union all
                    	select 3 num union all
                    	select 4 num union all
                    	select 5 num union all
                    	select 6 num union all
                    	select 7 num union all
                    	select 8 num union all
                    	select 9 num) ones
                        cross join (select 0 num union all
                    				select 10 num union all
                    				select 20 num union all
                    				select 30 num union all
                    				select 40 num union all
                    				select 50 num union all
                    				select 60 num union all
                    				select 70 num union all
                    				select 80 num union all
                    				select 90 num) tens
                    	cross join (select 0 num union all
                    				select 100 num union all
                    				select 200 num union all
                    				select 300 num) hundreds
                    order by days;
                    	
                    				
                    
                    ```
                    
            2. ìˆ«ì ì§‘í•©ì„ ë‚ ì§œ ì§‘í•©ìœ¼ë¡œ ë³€í™˜ & ì´ˆê³¼ í–‰ ì œê±° í•˜ê¸° 
                - ì½”ë“œ
                    
                    ```sql
                    select date_add('2020-01-01', interval (ones.num + tens.num + hundreds.num) DAY) dt 
                    from (select 0 num union all
                    	select 1 num union all
                    	select 2 num union all
                    	select 3 num union all
                    	select 4 num union all
                    	select 5 num union all
                    	select 6 num union all
                    	select 7 num union all
                    	select 8 num union all
                    	select 9 num) ones
                        cross join (select 0 num union all
                    				select 10 num union all
                    				select 20 num union all
                    				select 30 num union all
                    				select 40 num union all
                    				select 50 num union all
                    				select 60 num union all
                    				select 70 num union all
                    				select 80 num union all
                    				select 90 num) tens
                    	cross join (select 0 num union all
                    				select 100 num union all
                    				select 200 num union all
                    				select 300 num) hundreds
                    where date_add('2020-01-01', 
                    	interval (ones.num + tens.num + hundreds.num) DAY) < '2021-01-01'
                    order by 1;
                    ```
                    
        - ì¥ì : DB ì„œë²„ê°€ 2020-01-01 + 59 í•  ë•Œ ìë™ìœ¼ë¡œ ê²°ê³¼ ì…‹ì— ì¶”ê°€ ìœ¤ì¼(2020-02-29)ë¥¼ í¬í•¨
        - ì‘ìš©: 2020ë…„(ë°ì´í„°ìƒìœ¼ë¡œëŠ” 2005)ì˜ ì¼ë³„ ì˜í™” ëŒ€ì—¬ íšŸìˆ˜ë¥¼ í•¨ê»˜ í‘œì‹œí•˜ëŠ” ë³´ê³ ì„œë¥¼ ìƒì„±í•˜ë¼
            - ì˜í™”ë¥¼ ëŒ€ì—¬í•˜ì§€ ì•Šì€ ë‚ ì„ ë¹„ë¡¯í•œ ê·¸ í•´ì˜ ëª¨ë“  ë‚ ì´ í¬í•¨ë˜ì–´ì•¼
            - ì½”ë“œ ğŸ±
                
                ```sql
                select days.dt, count(r.rental_id) num_rentals
                from rental r 
                	right outer join
                		# days ì‹œì‘ 
                		(select date_add('2005-01-01', interval(ones.num + tens.num + hundreds.num) DAY) dt 
                	    from
                		    # ones ë§Œë“¤ê¸°
                				(select 0 num union all
                				select 1 num union all
                				select 2 num union all
                				select 3 num union all
                				select 4 num union all
                				select 5 num union all
                				select 6 num union all
                				select 7 num union all
                				select 8 num union all
                				select 9 num
                		        ) ones
                		    # tens ë§Œë“¤ê¸°
                		    cross join (select 0 num union all
                						select 10 num union all
                						select 20 num union all
                						select 30 num union all
                						select 40 num union all
                						select 50 num union all
                						select 60 num union all
                						select 70 num union all
                						select 80 num union all
                						select 90 num
                		                ) tens
                		    # hundreds ë§Œë“¤ê¸°
                				cross join (select 0 num union all
                							select 100 num union all
                							select 200 num union all
                							select 300 num
                			                ) hundreds
                			where date_add('2005-01-01', interval (ones.num + tens.num + hundreds.num) DAY) < '2006-01-01'
                		) days
                	# right outer joinì˜ ì¡°ê±´
                  on days.dt = date(r.rental_date)
                group by days.dt
                order by 1;
                ```
                

### ìì—° ì¡°ì¸

- DB ì„œë²„ê°€ í•„ìš”í•œ ì¡°ì¸ ì¡°ê±´ ê²°ì •
    - ì—¬ëŸ¬ í…Œì´ë¸”ì—ì„œ ë™ì¼í•œ ì—´ ì´ë¦„ì„ ì‚¬ìš©í•´ì„œ ì ì ˆí•œ ì¡°ì¸ ì¡°ê±´ ì¶”ë¡ 
- ì˜ˆì‹œ
    
    ```sql
    select c.first_name, c.last_name, date(r.rental_date)
    from customer c
    natural join rental r;
    ```
    
    - ì•Œì•„ì„œ r.customer_id = c.customer_idë¥¼ ì¶”ê°€í•´ì„œ ë‘ í…Œì´ë¸”ì„ ì¡°ì¸í•˜ê¸´ í•˜ì§€ë§Œ, ë‘ í…Œì´ë¸”ì—ëŠ” ê°ê° last_update ì¹¼ëŸ¼ë„ ìˆë‹¤
        - ê·¸ë˜ì„œ r.last_update = c.last_updateë„ ì¡°ì¸ ì¡°ê±´ì— ë“¤ì–´ê°€ì§€ë§Œ, ì´ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” í–‰ì€ ì—†ë‹¤
        - ë”°ë¼ì„œ empty set return
    - natural joinìœ¼ë¡œ ê²°ê³¼ë¥¼ ê¼­ ì–»ê³  ì‹¶ë‹¤ë©´â€¦
        
        ```sql
        select cust.first_name, cust.last_name, date(r.rental_date)
        from 
        	# ì„œë¸Œì¿¼ë¦¬ ì‚¬ìš©í•´ì„œ customer table ìª½ì˜ last_update ì—´ì„ ì œì™¸í•œë‹¤ 
        	(select customer_id, first_name, last_name
            from customer
            ) cust
            # ê·¸ëŸ¼ ì—´ ì´ë¦„ì´ ë™ì¼í•œ ê±´ customer_id ë¿ì´ë¼ ì—¬ê¸°ì— ëŒ€í•´ ì¡°ì¸ ì‹¤í–‰ 
            natural join rental r;
        ```
        
- ê²°ë¡ : natural ì¡°ì¸ ìœ í˜•ì„ í”¼í•˜ê³  ëª…ì‹œì ì¸ ì¡°ì¸ ì¡°ê±´ê³¼ í•¨ê»˜ ë‚´ë¶€ ì¡°ì¸ì„ ì‚¬ìš©í•  ê²ƒì„ ê¶Œì¥
- ì‹¤ìŠµ
    - 10-1
        - me
            
            ```sql
            select c.first_name, c.last_name, sum(p.amount) total_amount
            from customer c 
              left outer join payment p
              on c.customer_id = p.customer_id
            group by c.customer_id;
            ```
            
    - 10-2
        - me
            
            ```sql
            select c.first_name, c.last_name, sum(p.amount) total_amount
            from payment p 
              right outer join customer c
              on c.customer_id = p.customer_id
            group by c.customer_id;
            ```
            
    - 10-3
        - me
            
            ```sql
            select ones.num + tens.num +1
            from (select 0 num union all
            	  select 1 num union all
                  select 2 num union all
                  select 3 num union all
                  select 4 num union all
                  select 5 num union all
                  select 6 num union all
                  select 7 num union all
                  select 8 num union all
                  select 9 num) ones
                  cross join 
            			  (select 0 num union all
            			  select 10 num union all
            			  select 20 num union all
            			  select 30 num union all
            			  select 40 num union all
            			  select 50 num union all
            			  select 60 num union all
            			  select 70 num union all
            			  select 80 num union all
            			  select 90 num ) tens
            order by 1;
            ```