# 16ì¥ ë¶„ì„ í•¨ìˆ˜

- reporting(ì§‘ê³„) í•¨ìˆ˜ vs. analytic í•¨ìˆ˜ vs. window í•¨ìˆ˜
    1. **ë¦¬í¬íŒ… í•¨ìˆ˜(ì§‘ê³„ í•¨ìˆ˜)**:
        - ë°ì´í„°ë¥¼ ê·¸ë£¹í™”í•˜ì—¬ ê° ê·¸ë£¹ì— ëŒ€í•´ ë‹¨ì¼ ê²°ê³¼ë¥¼ ë°˜í™˜.
        - GROUP BY ì ˆê³¼ í•¨ê»˜ ì‚¬ìš©.
        - ì˜ˆ: SUM(), COUNT(), AVG()
    2. **ë¶„ì„ í•¨ìˆ˜(ì• ë„ë¦¬í‹± í•¨ìˆ˜)**:
        - ê° í–‰ì— ëŒ€í•´ ì§‘ê³„ ê²°ê³¼ë¥¼ ì œê³µ.
        - OVER() ì ˆê³¼ í•¨ê»˜ ì‚¬ìš©.
        - ì˜ˆ: SUM() OVER(), AVG() OVER(), RANK() OVER()
    3. **ìœˆë„ìš° í•¨ìˆ˜**:
        - ë¶„ì„ í•¨ìˆ˜ì˜ ì¼ì¢…ìœ¼ë¡œ, ë°ì´í„°ì˜ íŠ¹ì • ë²”ìœ„ ë‚´ì—ì„œ ê³„ì‚°ì„ ìˆ˜í–‰.
        - PARTITION BYì™€ ORDER BYë¥¼ í¬í•¨í•˜ëŠ” OVER() ì ˆì„ ì‚¬ìš©í•˜ì—¬ ìœˆë„ìš°ë¥¼ ì •ì˜.
        - ì˜ˆ: RANK(), ROW_NUMBER(), LAG(), LEAD()
- ë¶„ì„ í•¨ìˆ˜ì˜ ê°œë… (ë°ì´í„° ìœˆë„ìš°)
    - DB ì„œë²„ê°€ ì¡°ì¸, í•„í„°ë§, ê·¸ë£¹í™”, ì •ë ¬ì„ ëë‚´ê³  ê²°ê³¼ì…‹ì´ ì™„ì„±ë˜ì–´ì„œ ë°˜í™˜ë˜ê¸° ì§ì „
        - ì¿¼ë¦¬ ì‹¤í–‰ì„ ì¼ì‹œ ì¤‘ì§€í•˜ê³  ë©”ëª¨ë¦¬ì— ì €ì¥ëœ ê²°ê³¼ ì‚´í´ë³´ê¸°
        - ì˜ˆ-ì˜ì—… ì‚¬ì› ì‹¤ì  ìˆœìœ„,  ì§€ì—­ íŒë§¤ì•¡ë³„ ìˆœìœ„, ë™ê¸°ê°„ëŒ€ ì „ë…„ ëŒ€ë¹„ ë°±ë¶„ìœ¨ ì°¨ì´, ê° ë³´ê³ ì„œì˜ ì„¹ì…˜ë³„ ì†Œê³„, ìµœì¢… ì„¹ì…˜ì˜ ì´ê³„ ë“±
    
    ### ë°ì´í„° ìœˆë„ìš°
    
    - ì¼ì • ê¸°ê°„ ë™ì•ˆì˜ ì›”ë³„ íŒë§¤ ì´ê³„ ìƒì„±
        - ì˜ˆ-2005ë…„ 5~8ì›”ê¹Œì§€ì˜ ì˜í™” ëŒ€ì—¬ì— ê´€í•œ ì›”ë³„ ì§€ë¶ˆì•¡ ìš”ì•½
            
            ```sql
            select quarter(payment_date) quarter,
            	monthname(payment_date) month_nm,
                sum(amount) monthly_sales
            from payment
            where year(payment_date) = 2005
            group by quarter(payment_date), monthname(payment_date);
            ```
            
            - ê²°ê³¼
                
                ![Untitled](16%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%92%E1%85%A1%E1%86%B7%E1%84%89%E1%85%AE%20dd200389011e4e70a9f62b9cc40e318a/Untitled.png)
                
                - ì´ 4ê°œì›” ì „ì²´ë¡œ ë³´ë©´ 7ì›”ì˜ ì›”ê°„ í•©ê³„ê°€ ê°€ì¥ ë†’ê³ , 2ë¶„ê¸° ë‚´ë¡œ ë³´ë©´ 6ì›”ì´ ê°€ì¥ë†’ì€ ì›”ê°„ í•©ê³„ ë³´ì„
    - ë¶„ê¸°ë‹¹ ìµœëŒ“ê°’ ë° ì „ì²´ ê¸°ê°„ì— ëŒ€í•œ ìµœëŒ“ê°’ì„ í‘œì‹œí•˜ëŠ” ì—´ì„ ê° í–‰ì— ì¶”ê°€í•˜ê¸°
        
        ```sql
        select quarter(payment_date) quarter,
        	monthname(payment_date) month_nm,
            sum(amount) monthly_sales, # group by 
        	  # over ë’¤ì— ë¹ˆ ê´„í˜¸ë¼ì„œ ì „ì²´ í–‰ì— ëŒ€í•´ ì ìš© 
            max(sum(amount))
        		over () max_overall_sales, 
        		# over ë’¤ì— partition ê¸°ì¤€ ì œì‹œ - ê° ì¡°ê°(ì¿¼í„°) ë‹¹ í•œë²ˆì˜ ìœˆë„ìš° í•¨ìˆ˜ ì ìš© 
        		max(sum(amount))
        		over (partition by quarter(payment_date)) max_qrtr_sales
        from payment 
        where year(payment_date) = 2005
        # ê·¸ë£¹í™”ê°€ ëë‚˜ë©´ ê° í–‰ì€ ë¶„ê¸°ë³„, ì›”ë³„ ë°ì´í„°ê°€ ë˜ì–´ ìˆìŒ 
        group by quarter(payment_date), monthname(payment_date)   
        ```
        
        - **ì „ì²´ í–‰ì„** ë‘ ê°œì˜ ì§‘í•©ìœ¼ë¡œ ê·¸ë£¹í™”
            - ê·¸ë£¹1: ê°™ì€ ë¶„ê¸°ì˜ ëª¨ë“  í–‰ í¬í•¨
                - partition by. ìœˆë„ìš° í•¨ìˆ˜ê°€ í•œë²ˆì— ì ìš©ë˜ëŠ” ë²”ìœ„ë¥¼ ìª¼ê°œëŠ” ê¸°ì¤€. group byì™€ ë‹¤ë¥´ê²Œ ì›ë³¸ í–‰ ìˆ˜ê°€ ì¤„ì–´ë“¤ì§€ ì•ŠìŒ
            - ê·¸ë£¹2: ì „ì²´ ëª¨ë“  í–‰ í¬í•¨
    - ìœˆë„ìš° í•¨ìˆ˜(Window Function)
        - í…Œì´ë¸”ì˜ í–‰ì„ ê·¸ë£¹ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ê° ê·¸ë£¹ ë‚´ì—ì„œ íŠ¹ì • ì—°ì‚°ì„ ìˆ˜í–‰í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µ
        - ì¼ë°˜ì ìœ¼ë¡œ OVER ì ˆê³¼ í•¨ê»˜ ì‚¬ìš©ë˜ë©°, ê·¸ë£¹í™”ëœ ë°ì´í„° ë‚´ì—ì„œ ìˆœìœ„, í•©ê³„, í‰ê·  ë“±ì˜ ì—°ì‚°ì„ ìˆ˜í–‰
            - `window_function()` `OVER` (`PARTITION BY` column_name ) AS `window_column`
        - [ ]  ì¶”ê°€ ë‚´ìš©
            - (í™•ì‹¤) partition byëŠ” select ì ˆ ë‹¨ê³„ì—ì„œ ì‹¤í–‰ëœë‹¤
            - (í™•ì‹¤) select ì ˆì€ group by ì ˆì´ ì‹¤í–‰ëœ ë‹¤ìŒì— ì‹¤í–‰ëœë‹¤
            - (ë¶ˆí™•ì‹¤) partition byëŠ” group by ë¡œ ê·¸ë£¹í™”ë˜ê¸° ì´ì „ì˜ ì „ì²´ í–‰ì— ëŒ€í•´ ì‹¤í–‰ëœë‹¤
                - ?
    
    ### ë¡œì»¬ ì •ë ¬
    
    - ì˜ˆ-íŒë§¤ëŸ‰ì´ ê°€ì¥ ë†’ì€ ë‹¬ì— ê°’ 1ì´ ì£¼ì–´ì§€ëŠ” ê° ì›”ì˜ ìˆœìœ„ ë²ˆí˜¸(rank)ë¥¼ ì •ì˜
        
        ```sql
        select quarter(payment_date) quarter,
        			 monthname(payment_date) month_nm,
        	     sum(amount) monthly_sales,
        	     rank() over (order by sum(amount) desc) sales_rank
        from payment
        where year(payment_date) = 2005
        group by quarter(payment_date), monthname(payment_date), month(payment_date)
        order by 1, month(payment_date);
        ```
        
        - ë‹¤ì¤‘ order by
            1. ì¿¼ë¦¬ ëì—ì„œ ê²°ê³¼ì…‹ ì •ë ¬ (order by 1, month(payment_date))
            2. ìˆœìœ„ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ìˆœìœ„ë¥¼ í• ë‹¹ (rank() over (order by sum(amount) desc) sales_rank)
        - `rank() over (order by sum(amount) desc) sales_rank`
            1. ê·¸ë£¹í™” 
                1. ë°ì´í„° ë³€í™˜: ê° í–‰ì— ëŒ€í•´ ë¶„ê¸°ì™€ ì›”ì´ ê³„ì‚°ë¨ 
                2. ë¶„ê¸°, ì›” ê°€ëŠ¥í•œ ëª¨ë“  ì¡°í•©ì— ëŒ€í•´ ê·¸ë£¹ì´ ìƒì„±  
                3. ì§‘ê³„ í•¨ìˆ˜ ì‹¤í–‰ - ê° ê·¸ë£¹ì— ëŒ€í•´ sum amount 
            2. ì •ë ¬ 
                1. ë¶„ê¸°-ì›” ê·¸ë£¹ë³„ í•©ê³„ ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ 
            3. ìˆœìœ„ ë¶€ì—¬
                1. í•©ê³„ ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ë™ì¼í•œ ê°’ì— ëŒ€í•´ ë™ì¼í•œ ìˆœìœ„ ë¶€ì—¬ 
                    - ë™ì¼í•œ ìˆœìœ„ê°€ ë¶€ì—¬ëœ í›„ì—ëŠ” ë‹¤ìŒ ìˆœìœ„ê°€ ê±´ë„ˆë›°ì–´ ë§¤ê²¨ì§
    - rank í•¨ìˆ˜ì— paritition by, order by í•˜ìœ„ì ˆì´ ëª¨ë‘ ì‚¬ìš©ë˜ëŠ” ê²½ìš° â¤ï¸â€ğŸ”¥
        - ì „ì²´ ê²°ê³¼ì…‹ì—ì„œ ë‹¨ì¼ ìˆœìœ„ ëŒ€ì‹  ë¶„ê¸°ë³„ ìˆœìœ„ë¥¼ ì œê³µí•˜ë„ë¡
            
            ```sql
            select quarter(payment_date) quarter,
            	monthname(payment_date) month_nm,
                sum(amount) monthly_sales,
                rank() over (partition by quarter(payment_date)
            				 order by sum(amount) desc) qtr_sales_rank
            from payment
            where year(payment_date) = 2005
            group by quarter(payment_date), monthname(payment_date), month(payment_date)
            order by 1, month(payment_date);
            ```
            
            1. ê·¸ë£¹í™”
                1. ë°ì´í„° ë³€í™˜: ê° í–‰ì— ëŒ€í•´ ë¶„ê¸°, ì›” êµ¬í•œë‹¤
                2. ê·¸ë£¹í™”: ê°™ì€ ë¶„ê¸°-ì›” ì¡°í•©ì— ëŒ€í•´ ê·¸ë£¹ìœ¼ë¡œ ë¬¶ëŠ”ë‹¤  
            2. íŒŒí‹°ì…”ë‹
                - quarter ê°’ì— ë”°ë¼ í–‰ì„ ì—¬ëŸ¬ ê·¸ë£¹ìœ¼ë¡œ ë‚˜ëˆˆë‹¤
                - ì´í›„ì˜ ë™ì‘ì€ ë§¤ ê·¸ë£¹ë§ˆë‹¤ ì‹¤í–‰ë¨
            3. ì§‘ê³„ í•¨ìˆ˜ ì‹¤í–‰
                - í•˜ë‚˜ì˜ ê·¸ë£¹ ì•ˆì˜ ê° í–‰ì— ëŒ€í•´ sum(amount) ì‹¤í–‰
                - ê·¸ë£¹í™” ì§€ë‚˜ë©´ ê°™ì€ ë¶„ê¸° ì•ˆì—ì„œëŠ” ì›”ë³„ë¡œ ë°ì´í„°ê°€ ê·¸ë£¹í™”ëœ ìƒíƒœ
                - ì„œë¡œ ë‹¤ë¥¸ ë‚ ì§œë¼ë„ ê°™ì€ ì›”ì´ë©´ í•˜ë‚˜ë¡œ ì§‘ê³„ë¨
                - ì›”ë³„ sum()ì„ êµ¬í•œë‹¤
                - í—·ê°ˆë¦¬ì§€ë§Œ ê·¸ëƒ¥ í•˜ë‚˜ì˜ ë¶„ê¸° ì•ˆì—ì„œ sum(amount) í•œë‹¤ê³  ìƒê°í•˜ë©´ ë¨
            4. ì •ë ¬
                - í•˜ë‚˜ì˜ ê·¸ë£¹(ë¶„ê¸°) ì•ˆì—ì„œ ì›”ë³„ í•©ê³„ ìˆ˜ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
    
- ìˆœìœ„ â¤ï¸â€ğŸ”¥
    - ìˆœìœ„ í•¨ìˆ˜
        - `row_number` : ë™ì ì¼ ê²½ìš° ìˆœìœ„ê°€ ì„ì˜ ì§€ì •. ê° í–‰ë§ˆë‹¤ ê³ ìœ  ë²ˆí˜¸
            - ë™ì ì´ë¼ë„ rankê°€ ê°™ì€ í–‰ ì—†ìŒ
        - `rank` : ë™ì ì¼ ê²½ìš° ìˆœìœ„ì— ì°¨ì´ê°€ ìˆëŠ” ë™ì¼í•œ ìˆœìœ„ë¥¼ ë°˜í™˜
            - ë™ì ì¸ í–‰ ìˆ˜ë¥¼ ë”í•´ì„œ ë‹¤ìŒ ìˆœìœ„ê°€ ì •í•´ì§. 3ë“±ì´ 2ëª…ì´ë©´ ë‹¤ìŒ ë“±ìˆ˜ëŠ” 5
        - `dense_rank` : ë™ì ì¼ ê²½ìš° ìˆœìœ„ì— ì°¨ì´ê°€ ì—†ëŠ” ë™ì¼í•œ ìˆœìœ„ ë°˜í™˜
            - ë™ì ì€ ë™ì ëŒ€ë¡œ ê°™ì€ ìˆœìœ„ ì£¼ê³ , ì´ì–´ì„œ ë‹¤ìŒ ë“±ìˆ˜. 3ë“±ì´ ëª‡ ëª…ì´ë“  ë‹¤ìŒ ë“±ìˆ˜ëŠ” 4
    - ì˜ˆ-ìƒìœ„10ëª…ì˜ ê³ ê° íŒŒì•…
        
        ```sql
        select customer_id, count(*) num_rentals,
        	row_number() over (order by count(*) desc) row_number_rank,
            rank() over (order by count(*) desc) Rank_rank,
            dense_rank() over (order by count(*) desc) dense_rank_rank
        from rental
        group by customer_id
        order by 2 desc;
        ```
        
        ![Untitled](16%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%92%E1%85%A1%E1%86%B7%E1%84%89%E1%85%AE%20dd200389011e4e70a9f62b9cc40e318a/Untitled%201.png)
        
        - row_number(): ì •í™•íˆ 10ëª…ì„ ê°€ì ¸ë‹¤ì£¼ì§€ë§Œ, ì ìˆ˜ë¡œ ë´¤ì„ ë•Œ 10ìœ„ ê³ ê°ê³¼ ë™ì¼í•œ ëŒ€ì—¬ íšŸìˆ˜ê°€ ìˆëŠ” 11ìœ„+a ê³ ê°ì´ 10ëª…ì— ë“¤ì§€ ëª»í•´ ì œì™¸ëœë‹¤ëŠ” ë‹¨ì 
        - rank(): ì ìˆ˜ë„ ê³µì •í•˜ê³ , ì •í™•íˆ 10ëª…ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ
            - ì¤‘ê°„ì— ìˆëŠ” ë™ì ìëŠ” ë‹¤ìŒ ìˆœìœ„ì—ì„œ ë‹¤ countê°€ ë¨
            - ë§ˆì§€ë§‰ ë“±ìˆ˜ëŠ” 10ì´ ì•„ë‹ˆì§€ë§Œ 11ìœ„ ë°”ë¡œ ì•ì—ì„œ ëŠìœ¼ë©´ 10ëª…ì´ ì±„ì›Œì§
                
                ![Untitled](16%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%92%E1%85%A1%E1%86%B7%E1%84%89%E1%85%AE%20dd200389011e4e70a9f62b9cc40e318a/Untitled%202.png)
                
            - ëŒ€ë¶€ë¶„ì˜ ê²½ìš° best
            - ê·¼ë° ì–˜ë¥¼ ë“¤ì–´ 1 1 1 1 1 5 5 5ì—ì„œ 5ìœ„ê¹Œì§€ ëŠëŠ”ë‹¤ê³  í•˜ë©´ 8ëª…ì´ ë“¤ì–´ê°€ê¸´ í•¨
        - dense_rank(): ì ìˆ˜ë¡œ ìƒìœ„ 10ìœ„ë¥¼ ëŠì„ ìˆ˜ ìˆì§€ë§Œ, ì‚¬ëŒ ìˆ˜ëŠ” 10ëª…ì´ í›¨ì”¬ ë„˜ëŠ”ë‹¤
    - ë‹¤ì–‘í•œ ìˆœìœ„ ìƒì„±
        - ë™ì¼í•œ ê²°ê³¼ì…‹ì—ì„œ ì—¬ëŸ¬ ìˆœìœ„ ì§‘í•© ìƒì„±
            - ì˜ˆ-ë§¤ì›” ìƒìœ„ 5ëª…ì˜ ê³ ê°ì„ ì°¾ê¸°
                
                ```sql
                select customer_id, rental_month, num_rentals, rank_rnk ranking
                from (select customer_id, 
                				monthname(rental_date) rental_month,
                        count(*) num_rentals,
                        rank() over (partition by monthname(rental_date) order by count(*) desc) rank_rnk
                			from rental
                	    group by customer_id, monthname(rental_date)
                	    ) cust_rankings
                where rank_rnk <= 5
                order by rental_month, num_rentals desc, rank_rnk;
                ```
                
                - ë¶„ì„ í•¨ìˆ˜ëŠ” select ì ˆì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì¿¼ë¦¬ ì¤‘ì²©í•˜ëŠ” ê²½ìš°ê°€ ì¢…ì¢… ìˆìŒ
                1. from ì ˆë¶€í„° í•´ì„œ cust_rankings ë¶ˆëŸ¬ ì˜¨ë‹¤ê³  í•˜ë©´ 
                    1. rental í…Œì´ë¸” ë“¤ê³  ì˜¤ê¸°
                    2. ì•„ì´ë””ë‘ ë‹¬ ì´ë¦„ìœ¼ë¡œ ê·¸ë£¹í™” - ê³ ê°ë³„ ì›”ë³„ ì´ìš©í•©ê³„ ê¸ˆì•¡ ë‚˜ì˜´ â¤ï¸â€ğŸ”¥
                        - group byë§Œ í•œ ìƒíƒœ
                            
                            ![Untitled](16%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%92%E1%85%A1%E1%86%B7%E1%84%89%E1%85%AE%20dd200389011e4e70a9f62b9cc40e318a/Untitled%203.png)
                            
                            - ì›”ë³„ ì´ìš© ê¸°ë¡ì´ ìˆëŠ” customer_idë‘ rental_monthê°€ ë‚˜ì™€ìˆìŒ
                                - ê°™ì€ ì¡°í•©ì´ ì—¬ëŸ¬ ê°œ í–‰ìœ¼ë¡œ ì¡´ì¬í•˜ì§€ë§Œ, ê·¸ë£¹ì˜ ëŒ€í‘œê°’(unique ì¡°í•©)ìœ¼ë¡œ aggregate
                        - count(*) ì§‘ê³„í•¨ìˆ˜ ì¶”ê°€í•œ ìƒíƒœ
                            
                            ![Untitled](16%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%92%E1%85%A1%E1%86%B7%E1%84%89%E1%85%AE%20dd200389011e4e70a9f62b9cc40e318a/Untitled%204.png)
                            
                            - ì „ì²´ í…Œì´ë¸”ì—ì„œ í•˜ë‚˜ì˜ ì¡°í•©ì— ëŒ€í•´ ëª‡ ê°œì˜ í–‰ì´ ì¡´ì¬í•˜ëŠ”ì§€ count
                                - í•˜ë‚˜ì˜ ì¡°í•©ì„ ê°–ëŠ” í–‰ì´ ì—¬ëŸ¬ ë²ˆ ë“±ì¥í•œ ê²ƒì„ í•˜ë‚˜ì˜ ìˆ«ìë¡œ aggregate
                        - í—·ê°ˆë ¸ë˜ ë¶€ë¶„
                            
                            **1. ë°ì´í„° ê·¸ë£¹í™”**
                            
                            GROUP BY ì ˆì´ ì‹¤í–‰ë˜ë©´, ë°ì´í„°ë² ì´ìŠ¤ ì—”ì§„ì€ ì§€ì •ëœ ì—´ì„ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„°ë¥¼ ê·¸ë£¹í™”í•©ë‹ˆë‹¤. ê° ê·¸ë£¹ì€ í•´ë‹¹ ê·¸ë£¹ì˜ í‚¤(ì˜ˆ: customer_idì™€ monthname(rental_date) ì¡°í•©)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì‹ë³„ë©ë‹ˆë‹¤.
                            
                            **2. ì„ì‹œ ì €ì¥ì†Œ**
                            
                            ê° ê·¸ë£¹ ë‚´ì˜ í–‰ë“¤ì€ ë°ì´í„°ë² ì´ìŠ¤ ì—”ì§„ì˜ ë©”ëª¨ë¦¬ë‚˜ ë””ìŠ¤í¬ ê¸°ë°˜ì˜ ì„ì‹œ í…Œì´ë¸”ì— ì €ì¥ë©ë‹ˆë‹¤. ì´ ì„ì‹œ ì €ì¥ì†ŒëŠ” ê° ê·¸ë£¹ ë‚´ì˜ ëª¨ë“  í–‰ì„ í¬í•¨í•˜ë©°, ë‚˜ì¤‘ì— ì§‘ê³„ í•¨ìˆ˜ê°€ ì´ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê³„ì‚°ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
                            
                            **3. ì§‘ê³„ í•¨ìˆ˜ ê³„ì‚°**
                            
                            ì§‘ê³„ í•¨ìˆ˜ëŠ” ê° ê·¸ë£¹ ë‚´ì˜ í–‰ë“¤ì„ ìˆœíšŒí•˜ë©´ì„œ ê³„ì‚°ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, count(*) í•¨ìˆ˜ëŠ” ê° ê·¸ë£¹ ë‚´ì˜ í–‰ ìˆ˜ë¥¼ ì…‰ë‹ˆë‹¤. ë‹¤ë¥¸ ì§‘ê³„ í•¨ìˆ˜(ì˜ˆ: SUM(), AVG(), MAX(), MIN())ë„ ê° ê·¸ë£¹ ë‚´ì˜ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê³„ì‚°ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
                            
                    3. ê·¸ë£¹í™” ê¸°ì¤€ì´ì—ˆë˜ ì¹¼ëŸ¼ ê·¸ëŒ€ë¡œ selectë¡œ ë“¤ê³  ì˜¤ê³  
                    4. ìœˆë„ìš° í•¨ìˆ˜ ì‹œì‘ 
                        1. ë‹¬ ì´ë¦„ìœ¼ë¡œ partitioning
                        2. í•˜ë‚˜ì˜ ë‹¬ ì•ˆì—ì„œ id-ì›” ì´ë¦„ ì¡°í•©ì´ ëª‡ ê°œì”© ë‚˜ì™”ëŠ”ì§€ count
                            
                            =  íŠ¹ì • ê³ ê°ì˜ ì›”ë³„ ì´ìš©íšŸìˆ˜ê°€ ë‚˜ì˜´ 
                            
                        3. b ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ 
                        4. c ê°’ì„ ê¸°ì¤€ìœ¼ë¡œìˆœìœ„ ë¶€ì—¬ 
                2. where ì ˆ ì‹¤í–‰ 
                    - cust_rankingsì˜ rank_rnk ì¹¼ëŸ¼ ê°’ì´ 5ë³´ë‹¤ í° í–‰ ì œì™¸
                3. select ì ˆì— ìˆëŠ” ì¹¼ëŸ¼ ë“¤ê³  ì˜¤ê¸°
                4. order by ì—¬ëŸ¬ ê°œ ê¸°ì¤€ ìˆœì°¨ì ìœ¼ë¡œ ì •ë ¬
                    1. rental_monthë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
                    2. ë™ì¼í•œ rental_month ë‚´ì—ì„œ num_rentalsë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
                    3. num_rentalsê°€ ë™ì¼í•œ ê²½ìš°, rank_rnkë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬í•©ë‹ˆë‹¤.
                    
- ë¦¬í¬íŒ… í•¨ìˆ˜ â¤ï¸â€ğŸ”¥
    - ì˜ˆ-ì§€ë¶ˆ ê¸ˆì•¡ì´ 10ë‹¬ëŸ¬ ì´ìƒì¸ ëª¨ë“  í–‰ì— ëŒ€í•´ ì›”ë³„ ë° ì „ì²´ ì´ê³„ë¥¼ ìƒì„±
        
        ```sql
        select monthname(payment_date) payment_month,
        	amount, 
        	sum(amount) over (partition by monthname(payment_date)) monthly_total,
        	sum(amount) over () grand_total
        from payment
        where amount >= 10
        order by 1;
        ```
        
        1. payment table ë“¤ê³  ì˜¨ë‹¤
        2. where ì ˆì—ì„œ amount ì¹¼ëŸ¼ ê°’ì´ 10ë³´ë‹¤ ì‘ì€ í–‰ë“¤ ì œì™¸ 
        3. select ì— ì–¸ê¸‰ëœ ì¹¼ëŸ¼ ë“¤ê³  ì˜¨ë‹¤
            1. payment_date â†’ monthë¡œ ë°ì´í„° ë³€í™˜
            2. amount ê¸ˆì•¡ ê·¸ëŒ€ë¡œ
            3. ìœˆë„ìš° í•¨ìˆ˜ ì‹¤í–‰ 
                1. ì›”ë³„ë¡œ íŒŒí‹°ì…”ë‹ 
                2. ê° ì›”ì— ì†í•œ ëª¨ë“  í–‰ì˜ amount ì¹¼ëŸ¼ ìˆ˜ì¹˜ í•©ê³„ 
                
                = íŠ¹ì • ì§€ë¶ˆ ë‚ ì§œì— ëŒ€í•´, ê·¸ ë‚ ì§œê°€ ì†í•œ ë‹¬ì˜ ì´ ì§€ë¶ˆ ê¸ˆì•¡ì„ ì˜†ì— ê°™ì´ ë³´ì—¬ì¤Œ 
                
            4. ìœˆë„ìš° í•¨ìˆ˜ ì‹¤í–‰
                1. ëª¨ë“  í–‰ì— ëŒ€í•´ amount ì¹¼ëŸ¼ ì „ì²´ í•©ê³„ ê¸ˆì•¡ í‘œì‹œ 
                
                = ì›”ê°„ ì§€ë¶ˆ ê¸ˆì•¡ ì¹¼ëŸ¼ ì˜†ì— ì „ì²´ ì§€ë¶ˆ ê¸ˆì•¡ ì¹¼ëŸ¼ ë³´ì—¬ì¤Œ 
                
        4. payment_month ì¹¼ëŸ¼ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ 
            
            
        
    - ì˜ˆ-ì „ì²´ ì§€ë¶ˆ ê¸ˆì•¡ ì¤‘ ì›”ê°„ ì´ ì§€ë¶ˆ ê¸ˆì•¡ì˜ share ê³„ì‚°  â¤ï¸â€ğŸ”¥
        
        ```sql
        select monthname(payment_date) payment_month, 
        	sum(amount) month_total,
            round(sum(amount) / sum(sum(amount)) over () * 100, 2) month_share
        from payment
        group by monthname(payment_date)
        ```
        
        - ROUND() í•¨ìˆ˜ê°€ í¬í•¨ëœ ë¼ì¸ ê³„ì‚° ê³¼ì •
            1. **SUM(amount)**:
            - ì´ í•¨ìˆ˜ëŠ” ê° payment_monthì— ëŒ€í•œ amount ê°’ì˜ í•©ê³„ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
            - ì˜ˆë¥¼ ë“¤ì–´, payment_monthê°€ â€˜Januaryâ€™ì¸ ê²½ìš°, í•´ë‹¹ ì›”ì˜ ëª¨ë“  amount ê°’ì„ ë”í•©ë‹ˆë‹¤.
            1. **SUM(SUM(amount)) OVER ()**:
            - ì´ í•¨ìˆ˜ëŠ” ì „ì²´ ë°ì´í„°ì…‹ì— ëŒ€í•´ amount ê°’ì˜ í•©ê³„ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
            - SUM(amount)ëŠ” GROUP BY ì ˆì— ë”°ë¼ ê° ì›”ë³„ í•©ê³„ë¡œ ê³„ì‚°ëœ í›„, SUM(SUM(amount)) OVER ()ëŠ” ì´ ì›”ë³„ í•©ê³„ë¥¼ ë‹¤ì‹œ í•©ì‚°í•˜ì—¬ ì „ì²´ í•©ê³„ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
            - ì˜ˆë¥¼ ë“¤ì–´, ê° ì›”ì˜ SUM(amount) ê°’ì´ ê³„ì‚°ëœ í›„, ì´ ê°’ë“¤ì„ ë‹¤ì‹œ ëª¨ë‘ í•©ì‚°í•©ë‹ˆë‹¤.
            
    - ì˜ˆ-ì›” ì´ê³„ê°€ ìµœëŒ€, ìµœì†Œ ë˜ëŠ” ì¤‘ê°„ì— ìˆëŠ”ì§€ ì—¬ë¶€ íŒë³„
        
        ```sql
        select monthname(payment_date) payment_month,
        sum(amount) month_total,
        case sum(amount)
        	when max(sum(amount)) over () then 'Highest'
            when min(sum(amount)) over () then 'Lowest'
            else 'Middle'
            end
        amount_level # quasi-ranking
        from payment
        group by monthname(payment_date) # ë¹„êµ ìš©ë„ 
        ```
        
    - ìœˆë„ìš° í”„ë ˆì„
        - ë¶„ì„í•¨ìˆ˜ì— ëŒ€í•œ ë°ì´í„° ìœˆë„ìš°ëŠ” partition by ì ˆì„ ì‚¬ìš©í•˜ì—¬ ì •ì˜ â†’ ê³µí†µ ê°’ ë³„ë¡œ í–‰ì„ ê·¸ë£¹í™”
        - ë°ì´í„° ìœˆë„ìš°ì— í¬í•¨í•  í–‰ì„ ë” ì„¸ë°€í•˜ê²Œ ì œì–´í•˜ë ¤ë©´?
            - ì˜ˆ-ì—°ì´ˆë¶€í„° í˜„ì¬ í–‰ê¹Œì§€ ëˆ„ì  í•©ê³„ ìƒì„± â†’ ë°ì´í„° ìœˆë„ìš°ì— í¬í•¨í•  í–‰ì„ ì •ì˜í•˜ê¸° ìœ„í•´ frame í•˜ìœ„ì ˆ í¬í•¨
        - ì˜ˆ-ë§¤ì£¼ ì§€ë¶ˆì•¡ì„ í•©ì‚°í•˜ê³  ë¡¤ë§ í•©ê³„ë¥¼ ê³„ì‚°í•˜ëŠ” ë¦¬í¬íŒ… í•¨ìˆ˜ë¥¼ í¬í•¨í•˜ëŠ” ì¿¼ë¦¬ â¤ï¸â€ğŸ”¥
            
            ```sql
            select yearweek(payment_date) as payment_week, sum(amount) as week_sum, 
            		sum(sum(amount)) 
            				over (order by yearweek(payment_date) 
            								rows unbounded preceding) rolling_sum
            from payment
            group by yearweek(payment_date)
            ```
            
        - ì˜ˆ-ë§¤ì£¼ ì§€ë¶ˆì•¡ì„ í•©ì‚°í•˜ê³  3ì£¼ì¹˜ ë¡¤ë§ í‰ê· ì„ ê³„ì‚°
            
            ```sql
            select yearweek(payment_date) as payment_week, sum(amount) as week_sum, 
            		avg(sum(amount)) 
            			over (order by yearweek(payment_date) 
            					rows between 1 preceding and 1 following) rolling_3wk_avg
            from payment
            group by yearweek(payment_date)
            ```
            
            - ì „ì£¼, ê¸ˆì£¼, ë‹¤ìŒì£¼ ì„¸ ì£¼ì˜ í‰ê· ì„ êµ¬í•˜ê¸°
                - ì²«ì£¼ëŠ” ì „ì£¼ê°€ ì—†ìœ¼ë¯€ë¡œ ì œì™¸, ë§ˆì§€ë§‰ ì£¼ëŠ” ë‹¤ìŒì£¼ê°€ ì—†ìœ¼ë¯€ë¡œ ì œì™¸
        - ì˜ˆ-ì „ 3ì¼ + ê¸ˆì¼ + í›„ 3ì¼ = ì´ 7ì¼ì— ëŒ€í•œ ë¡¤ë§ í‰ê·  êµ¬í•˜ê¸° â¤ï¸â€ğŸ”¥
            - ì£¼ê°„ ë°ì´í„° ê³µë°±ì´ ìˆëŠ” ê²½ìš° - payment tableì—ëŠ” 2005ë…„ 23ì£¼ì— ëŒ€í•œ ë°ì´í„°ê°€ ì—†ìŒ
                - ë‚ ì§œ ê°„ê²©ì„ ì§€ì •í•˜ëŠ” ê²Œ ë” ì •êµí•˜ë‹¤
            
            ```sql
            select date(payment_date), sum(amount),
            avg(sum(amount)) 
            over 
            (order by date(payment_date)
            range between interval 3 day preceding and interval 3 day following) 7_day_avg
            from payment
            where payment_date between '2005-07-01' and '2005-09-01'
            group by date(payment_date)
            order by 1;
            ```
            
            1. payment table ê°€ì ¸ì˜¨ë‹¤ (from)
            2. ë‚ ì§œë¡œ í–‰ í•„í„°ë§ (where)
            3. ë‚ ì§œ string â†’ date typeìœ¼ë¡œ ë°ì´í„° ë³€í™˜ ë° ê·¸ë£¹í™” (group by)
            4. ê·¸ë£¹í™” ê¸°ì¤€, ì§‘ê³„(ì¼ë³„ í•©ì‚° ê¸ˆì•¡) ì¹¼ëŸ¼ ê°€ì ¸ì˜¨ ë’¤ ìœˆë„ìš° í•¨ìˆ˜ ì‹¤í–‰ 
                1. ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ (order by date)
                2. range ì„¤ì • â†’ ì •ë ¬ëœ ê° í–‰ì˜ payment_dateì— ì•ë’¤ 3ì¼ ë¶™ì—¬ì„œ ì´ 7ì¼ 
                3. ì§‘ê³„ í•¨ìˆ˜ ì‹¤í–‰: ë‚ ì§œë³„ amount sumì„ êµ¬í•œë‹¤ 
                4. ë¶„ì„ í•¨ìˆ˜ ì‹¤í–‰: í•´ë‹¹ ë²”ìœ„(7ì¼)ì˜ í‰ê· ì„ êµ¬í•œë‹¤ 
        - ++ rank í•¨ìˆ˜ê°€ ì•„ë‹Œë° ì™œ over ë’¤ì— order byê°€ í•„ìš”?
            - ê³„ì‚° ìˆœì„œê°€ ì¤‘ìš”í•œ ê²½ìš° - ì˜ˆ: ëˆ„ì  í•©. ë‚ ì§œê°€ ì„ì´ë©´ ì•ˆëœë‹¤. ìœ„ì—ì„œë¶€í„° ì°¨ê³¡ì°¨ê³¡
                
                ```sql
                SELECT 
                    payment_date, 
                    amount, 
                    SUM(amount) OVER (ORDER BY payment_date) AS cumulative_sum
                FROM 
                    payments;
                ```
                
            - íŠ¹ì • ë²”ìœ„ì— ìˆì–´ì„œë„ ë‚ ì§œë³„ë¡œ ì •ë ¬ì´ ë¨¼ì € ë˜ì–´ì•¼ ì•ë’¤ë¡œ ëª‡ ì¼ì”© ê°€ì ¸ì˜¨ë‹¤ê°€ ë§ì´ ë¨
                - ë’¤ì£½ë°•ì£½ì´ë©´ í˜„ì¬ í–‰ ì•ë’¤ë¡œ ê°€ì ¸ì™€ë„ ë‚ ì§œ ìƒìœ¼ë¡œëŠ” ì›í•˜ëŠ” ë²”ìœ„ê°€ ì•„ë‹ ìˆ˜ ìˆìŒ
    - lag() í•¨ìˆ˜ì™€ lead() í•¨ìˆ˜
        - í•œ í–‰ì˜ ê°’ì„ ë‹¤ë¥¸ í–‰ê³¼ ë¹„êµ
            - ì˜ˆ- ì›”ë³„ íŒë§¤ ì´ê³„ ìƒì„±ì‹œ ì´ì „ë‹¬ê³¼ì˜ ë°±ë¶„ìœ¨ ì°¨ì´ í‘œì‹œ
                - ì´ì „ í–‰ì—ì„œ ì›”ë³„ íŒë§¤ ì´ê³„ë¥¼ ê²€ìƒ‰í•˜ëŠ” ë°©ë²• í•„ìš”
        - lag í•¨ìˆ˜: ê²°ê³¼ì…‹ì˜ ì´ì „ í–‰ì—ì„œ ì—´ ê°’ì„ ê²€ìƒ‰
        - lead í•¨ìˆ˜: ê²°ê³¼ì…‹ì˜ ë‹¤ìŒ í–‰ì—ì„œ ì—´ ê°’ì„ ê²€ìƒ‰
        - ì˜ˆ-ì§ì „ ì£¼, ë°”ë¡œ ë‹¤ìŒ ì£¼ì™€ì˜ ì£¼ê°„ í•©ê³„ ê¸ˆì•¡ ë‚˜ë€íˆ í‘œì‹œí•˜ê¸°
            
            ```sql
            select yearweek(payment_date) payment_week,
            		sum(amount) week_total,
            		lag(sum(amount), 1) over (order by yearweek(payment_date)) prev_wk_tot,
                lead(sum(amount), 1) over (order by yearweek(payment_date)) next_wk_tot
            from payment
            group by yearweek(payment_date)
            order by 1;
            ```
            
            1. (from) payment table ë“¤ê³  ì˜¨ë‹¤
            2. (group by) payment_date ì¹¼ëŸ¼ì˜ ê°’ë“¤ì„ yearweekë¡œ ë³€í™˜í•œ ë’¤, ê°™ì€ ëŒ€í‘œê°’ë¼ë¦¬ ê·¸ë£¹í™”í•œë‹¤ 
            3. (select)
                1. ê·¸ë£¹í™” ê¸°ì¤€ ì¹¼ëŸ¼ ë“¤ê³  ì˜¨ë‹¤
                2. ê·¸ë£¹ë³„ ì§‘ê³„ í•¨ìˆ˜ (aggregation) ì ìš©í•œ ì¹¼ëŸ¼ ë“¤ê³  ì˜¨ë‹¤
                3. ìœˆë„ìš° í•¨ìˆ˜ ì‹¤í–‰ 
                    1. lag
                        1. over ë’¤ì— ìˆëŠ” êµ¬ë¬¸ ì‹¤í–‰ : yearweek ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬
                            - ì—¬ê¸°ì„œë„ ì •ë ¬ ë¨¼ì € í•˜ëŠ”ê²Œ ì¤‘ìš”í•˜ë‹¤. ê·¸ë˜ì•¼ offset ì ìš©í–ˆì„ ë•Œ ì›í•˜ëŠ” ëŒ€ë¡œ ì „ì£¼ì˜ ë°ì´í„°ë¥¼ ì–»ì„ ìˆ˜ ìˆê¸° ë•Œë¬¸
                            - selectëŠ” order byë³´ë‹¤ ë¨¼ì € ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— ë°ì´í„°ê°€ ì•„ì§ ì •ë ¬ì´ ì•ˆë˜ì–´ ìˆëŠ” ìƒíƒœì¼ìˆ˜ë„. ê±°ê¸°ì„œ offset ì ìš©í•˜ë©´ ì™  ìŒ©ëš± ë§ì€ í–‰ì„ ë“¤ê³  ì˜¬ ìˆ˜ë„
                        2. offset ì²´í¬: í˜„ì¬ í–‰(ì–´ë–¤ yearweek) ê¸°ì¤€ìœ¼ë¡œ 1ë§Œí¼ ì´ì „ í–‰ = ë°”ë¡œ ì „ yearweek
                        3. ê°€ì ¸ì˜¬ ê°’ ì²´í¬: ì´ì „ í–‰ì˜ sum(amount), ì¦‰ ì´ì „ yearweek ê·¸ë£¹ì˜ í•©ê³„ ê¸ˆì•¡ì„ ë“¤ê³  ì˜¨ë‹¤ 
                    2. lead
                        - lagë‘ ë¹„ìŠ·í•˜ì§€ë§Œ ì´ì „í–‰ì´ ì•„ë‹ˆë¼ ë‹¤ìŒ í–‰ì¸ ì°¨ì´ê°€ ìˆë‹¤
            4. (order by) yearweek ì¹¼ëŸ¼ ê°’ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ 
        - ì˜ˆ-ì „ì£¼ì™€ì˜ ë°±ë¶„ìœ¨ ì°¨ì´ ìƒì„± â¤ï¸â€ğŸ”¥
            - ì „ì£¼ì™€ì˜ ì°¨ë¥¼ êµ¬í•œ ë’¤, ê·¸ ì°¨ì´ê°€ ì „ì£¼ ìˆ˜ì¹˜ ëŒ€ë¹„ ì–¼ë§ˆë‚˜ ë˜ëŠ”ì§€
            
            ```sql
            select yearweek(payment_date) payment_week,
            				sum(amount) week_total,
                    round((sum(amount)-lag(sum(amount), 1) over (order by yearweek(payment_date)))/ lag(sum(amount), 1) over (order by yearweek(payment_date)) * 100, 1) pct_diff
            from payment
            group by yearweek(payment_date)
            order by 1;
            
            ```
            
            - ê³„ì‚° ì‹œì— ì‚¬ì¹™ì—°ì‚° ìš°ì„ ìˆœìœ„ ê³ ë ¤í•´ì„œ ê´„í˜¸ë¥¼ ì ì ˆí•˜ê²Œ ë„£ì–´ì¤˜ì•¼ í•˜ëŠ” ì  ì£¼ì˜
    - group_concat() í•¨ìˆ˜
        - ì—´ ê°’ ì§‘í•©ì„ í•˜ë‚˜ì˜ êµ¬ë¶„ëœ ë¬¸ìì—´ë¡œ í”¼ë²—í•˜ëŠ” ë° ì‚¬ìš©
            - XML, JSON ë¬¸ì„œë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ ê²°ê³¼ì…‹ì„ ë³€ë³„í•˜ëŠ” í¸ë¦¬í•œ ë°©ë²•
        - ì˜ˆ-ì˜í™” ì œëª©ë³„ë¡œ ê·¸ë£¹í™”í•˜ê³  ì •í™•íˆ ì„¸ ëª…ì˜ ë°°ìš°ê°€ ë‚˜ì˜¤ëŠ” ì˜í™”ë§Œ í¬í•¨
            
            ```sql
            select f.title,
            	group_concat(a.last_name order by a.last_name separator ', ') actors
            from actor a 
            	inner join film_actor fa
                on a.actor_id = fa.actor_id
                inner join film f
                on fa.film_id = f.film_id
            group by f.title
            having count(*)=3;
            ```
            
            1. from âœ actor table ê°€ì ¸ì˜¨ë‹¤ 
            2. join 
                
                âœ actor_id ê¸°ì¤€ìœ¼ë¡œ film_actor tableê³¼ ì¡°ì¸í•œë‹¤ 
                
                âœ film_id ê¸°ì¤€ìœ¼ë¡œ film tableê³¼ ì¡°ì¸í•œë‹¤ 
                
                â‡’ actor ì¹¼ëŸ¼ë“¤ | film_actor ì¹¼ëŸ¼ë“¤ | film ì¹¼ëŸ¼ë“¤ 
                
            3. group by âœ ì˜í™” ì œëª© ê¸°ì¤€ìœ¼ë¡œ ê·¸ë£¹í™”í•œë‹¤ 
                - ì˜í™” ì œëª© ê¸°ì¤€ìœ¼ë¡œ ì—¬ëŸ¬ ë°°ìš° í–‰ì´ í•˜ë‚˜ì˜ ê·¸ë£¹ì— ì†í•˜ê²Œ ë  ê²ƒ
            4. having âœ ì§‘ê³„ í•¨ìˆ˜ count ì‹¤í–‰ â†’ ê·¸ë£¹ë³„ í–‰ ìˆ˜ë¡œ aggregate â†’ ì´ ìˆ˜ê°€ 3 ë„˜ëŠ” ê·¸ë£¹ í•„í„°ë§ 
                - ë°°ìš°ê°€ ë”± ì„¸ ëª…ë§Œ ì¶œì—°í•œ ì˜í™”ë§Œ ë‚¨ì„ ê²ƒ
            5. select 
                1. ê·¸ë£¹í™” ê¸°ì¤€ ì¹¼ëŸ¼ ê°€ì ¸ì˜¤ê¸° 
                2. group_concat() ì‹¤í–‰ 
                    - ì˜í™” ì œëª© ê¸°ì¤€ìœ¼ë¡œ ì—¬ëŸ¬ ë°°ìš°ë“¤ì´ ê·¸ë£¹í™” ëœ ìƒíƒœ
                        - í•œ ê·¸ë£¹ ë‹¹ ì„¸ í–‰ë§Œ ì¡´ì¬
                    1. í•˜ë‚˜ì˜ ê·¸ë£¹ ì•ˆì—ì„œ ì˜í™” ë°°ìš° ì„± ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬
                    2. ì„¸ ë°°ìš°ì˜ last nameì„ êµ¬ë¶„ìë¥¼ ê°€ì§€ê³  ê²°í•© 
                    
                    â†’ í•œ ê·¸ë£¹ì€ í•˜ë‚˜ì˜ í–‰ìœ¼ë¡œ í‘œí˜„ë¨ 
                    
            
- ì‹¤ìŠµ
    - 1
        - [x]  ëª¨ë“  í–‰ì„ ê²€ìƒ‰í•˜ëŠ” ì¿¼ë¦¬
            - partitionì´ ì—†ë‹¤ëŠ” ëœ»ì¸ ë“¯
            - ì•„ë‹˜ ëª¨ë“  rowê°€ unique ê·¸ë£¹ì„ í˜•ì„±í•˜ê²Œë” ê·¸ë£¹í™” ê¸°ì¤€ì„ ì¹¼ëŸ¼ ì¡°í•©ìœ¼ë¡œ ë§Œë“¤ë¼ëŠ” ëœ»ì´ê±°ë‚˜
            
            ```sql
            select year(year_no), month(month_no), tot_sales, 
            				row_number() over (order by tot_sales)
            from Sales_Fact
            group by year(year_no), month(month_no)
            ```
            
        - ëª¨ë²”ë‹µì•ˆ
            - ëª¨ë“  í–‰ì„ ê²€ìƒ‰í•˜ëŠ” ì¿¼ë¦¬ = group by ì• ì´ˆì— í•  í•„ìš”ê°€ ì—†ë‹¤ëŠ” ëœ»ì´ì—ˆìŒ.
            
            ```sql
            select year_no, month_no, tot_sales, 
            				rank() over (order by tot_sales desc)
            from Sales_Fact
            ```
            
    - 2
        - [x]  ë‘ ìˆœìœ„ ì§‘í•©
            - ì—° ë³„ë¡œ 1~12ë¥¼ ê°ê° ë§Œë“¤ë¼ëŠ” ëœ»ì¸ë“¯
                
                ```sql
                select year(year_no), month(month_no), tot_sales, 
                				row_number() over (partition by year(year_no) order by tot_sales)
                from Sales_Fact
                group by year(year_no), month(month_no)
                ```
                
        - ëª¨ë²”ë‹µì•ˆ
            
            ```sql
            select year_no, month_no, tot_sales, 
            				rank() over (partition by year_no order by tot_sales desc) sales_rank
            from Sales_Fact
            ```
            
    - 3
        - ë‚´ ë‹µì•ˆ
            
            ```sql
            select year(year_no), month(month_no), tot_sales as this_month, 
            			lag(tot_sales, -1) over (order by month(month_no)) as last_month
            from Sales_Fact
            where year(year_no) = 2020
            group by month(month_no)
            ```
            
        - ëª¨ë²”ë‹µì•ˆ
            
            ```sql
            select year_no, month_no, tot_sales as this_month, 
            			lag(tot_sales) over (order by month(month_no)) as last_month
            from Sales_Fact
            where year(year_no) = 2020
            ```
            
            - ì´ë¯¸ ì—°,ì›”ì€ ì•Œë§ì€ í¬ë§·ì´ë¼ ìˆ˜ì •í•  í•„ìš” ì—†ìŒ
            - lag, lead í•¨ìˆ˜ offset ê¸°ë³¸ê°’ì€ 1
                - lag í•¨ìˆ˜ì—ì„œëŠ” ì´ì „ í–‰ì— ëŒ€í•œ offsetì´ë”ë¼ë„ ì–‘ìˆ˜ ì“°ë©´ ëœë‹¤
                - offsetìœ¼ë¡œ ìŒìˆ˜ëŠ” ì•ˆëœë‹¤ê³  í•¨