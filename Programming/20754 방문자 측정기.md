# 20754. 방문자 측정기

Created time: April 28, 2024 2:39 PM
Last edited time: April 29, 2024 11:36 AM

- 요약
    - 병렬이 아닌 상황에서 동시 다발로 들어오는 변수 변경 요청이 있을 때
    - 요청을 모두 처리한 후 최종 변경된 변수 값을 최소로 만드는
    - 요청 처리 순서를 구하라는 것
- 문제 큰 그림
    - 방문객이 어느 한 개찰구로만 들어왔을 경우
        - 그 개찰구 번호로만 읽기-쓰기하면 되어서 별도 케이스로 branching
        - 방문객 한 사람당 읽기 한번, 쓰기 한번
    - 방문객이 1인 개찰구가 있는 경우
        - 해당 개찰구에서 메인 서버 값을 읽어온 상태에서
            - 다른 개찰구의 방문객 처리 모두 해준 다음
        - 해당 개찰구의 방문객 처리 (1명) 한다
            - 그럼 중간에 증가된 방문객 수는 모두 없던 일이 됨
    - 방문객이 1인 개찰구가 없는 경우
        - 방문객 수가 0이 아닌 두 개찰구의 인덱스(a, b)를 구한다
        - 둘 중 하나의 개찰구를 방문객 1명만 남도록 작업한다
            - a에서 한 명만 읽어둔다음
                - b의 방문객을 한 명 빼고 모두 처리해둔다
            - a에서 한 명 쓴다
        - 방문객 한 명만 남도록 작업한 개찰구(barrier) 빼고 나머지 개찰구 모두 방문객 처리
            - barrier에서 남은 한명을 위해 메인 서버값 읽어둔다 (1인 상태)
                - a에서 처리된 한명 빼고 나머지 모두 방문객 처리
                - a,b 아닌 다른 개찰구도 모두 방문객 처리
            - barrier에서 한 명 쓰기 하면 총 2로 마무리
                - 그 사이에 처리된 방문객은 모두 2로 덮어쓰여진다는 말씀